<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dino惡搞版 By hongjan</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column; /* 讓標題和按鈕垂直排列 */
            height: 100vh;
            background-color: #2a8fd3;
        }
        canvas {
            border: 5px solid #000000;
        }
        .button {
            background-color: #ff7300; /* 橘色 */
            border: none;
            color: rgb(233, 233, 233);
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 8px;
        }
        .button:hover {
            background-color: #e26d00; /* 深橘色 */
        }
    </style>
</head>
<body>
    <h1>Dino惡搞版</h1>
    <p>點擊或按下空白鍵使小恐龍跳躍，避開障礙物，盡可能獲得更高的怒氣值！</p>
    <button id="startButton" class="button">開始遊戲</button>
    <canvas id="gameCanvas" width="600" height="200" style="display: none;"></canvas>
    <button id="restartButton" class="button" style="display: none;">重新開始</button>
    <a href="https://github.com/hongjan371792/Dino" class="button" target="_blank">GitHub</a>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        const dinoImg = new Image();
        dinoImg.src = 'dino.jpg'; // 修改為您提供的角色圖片路徑

        const obstacleImg1 = new Image();
        obstacleImg1.src = 'obstacle1.jpg'; // 第一種障礙物圖片路徑，設定好比例

        const obstacleImg2 = new Image();
        obstacleImg2.src = 'obstacle2.jpg'; // 第二種障礙物圖片路徑，設定好比例

        let score = 0;
        let highScore = getCookie('highScore') || 0; // 獲取 cookie 中的最高分數，如果不存在則預設為0
        let gameOver = false;
        let gameStarted = false;

        const dino = {
            x: 50,
            y: 150,
            width: 50,
            height: 50,
            speed: 5,
            jumpForce: 19, // 調整角色跳躍的力量
            fallingSpeed: 6, // 調整角色下落的速度
            jumping: false,
            draw() {
                ctx.drawImage(dinoImg, this.x, this.y, this.width, this.height);
            }
        };

        let obstacle = null;

        class Obstacle {
            constructor() {
                this.width = 20; // 障礙物寬度
                this.height = Math.random() > 0.5 ? 20 : 40; // 隨機選擇兩種不同高度的障礙物
                if (Math.random() > 0.5) {
                    this.img = obstacleImg1;
                } else {
                    this.img = obstacleImg2;
                }
                this.x = canvas.width;
                this.y = canvas.height - this.height;
            }

            draw() {
                ctx.drawImage(this.img, this.x, this.y, this.width, this.height); // 繪製障礙物圖片
            }

            update() {
                this.x -= dino.speed;
            }
        }

        function jump() {
            if (!dino.jumping) { // 只有在不在跳躍狀態時才能跳躍
                dino.jumping = true;
                let jumpInterval = setInterval(() => {
                    dino.y -= dino.jumpForce;
                    if (dino.y <= 30) { // 角色最高點為30
                        clearInterval(jumpInterval);
                        let fallInterval = setInterval(() => {
                            dino.y += dino.fallingSpeed;
                            if (dino.y >= 150) { // 角色回到地面
                                clearInterval(fallInterval);
                                dino.jumping = false;
                            }
                        }, 20);
                    }
                }, 20);
            }
        }

        document.addEventListener('keydown', event => {
            if (event.code === 'Space') {
                jump();
            }
        });

        document.addEventListener('touchstart', jump); // 觸控事件

        document.getElementById('startButton').addEventListener('click', () => {
            gameStarted = true;
            document.getElementById('startButton').style.display = 'none';
            canvas.style.display = 'block';
            gameLoop();
        });

        document.getElementById('restartButton').addEventListener('click', () => {
            score = 0;
            gameOver = false;
            obstacle = null;
            document.getElementById('restartButton').style.display = 'none';
            gameLoop();
        });

        function generateObstacle() {
            if (!obstacle) {
                obstacle = new Obstacle();
            }
        }

        function checkCollisions() {
            if (obstacle && dino.x < obstacle.x + obstacle.width &&
                dino.x + dino.width > obstacle.x &&
                dino.y < obstacle.y + obstacle.height &&
                dino.y + dino.height > obstacle.y) { // 確認碰撞
                    gameOver = true;
                    updateHighScore(); // 更新最高分數
                    return;
                }
            score++;
        }

        function updateHighScore() {
            if (score > highScore) {
                highScore = score;
                setCookie('highScore', highScore, 365); // 將最高分數儲存到 cookie 中，有效期為 365 天
            }
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';')[0];
        }

        function setCookie(name, value, days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = "expires=" + date.toUTCString();
            document.cookie = name + "=" + value + ";" + expires + ";path=/";
        }

        function gameLoop() {
            if (!gameOver) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                dino.draw();

                if (!obstacle || obstacle.x + obstacle.width < 0) {
                    obstacle = new Obstacle();
                }

                if (obstacle) {
                    obstacle.draw();
                    obstacle.update();
                }

                checkCollisions();

                ctx.fillStyle = '#333';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center'; // 設定文字置中
                ctx.fillText(`怒氣值: ${score}`, canvas.width / 2, 30); // 繪製分數文字
                ctx.fillText(`最高分: ${highScore}`, canvas.width / 2, 60); // 繪製最高分文字

                requestAnimationFrame(gameLoop);
            } else {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#333';
                ctx.font = '30px Arial';
                ctx.textAlign = 'center'; // 設定文字置中
                ctx.fillText('你用了免死金牌，被罵得更慘了', canvas.width / 2, canvas.height / 2 - 20);
                ctx.fillText(`怒氣值: ${score}`, canvas.width / 2, canvas.height / 2 + 20);
                ctx.fillText(`最高分: ${highScore}`, canvas.width / 2, canvas.height / 2 + 60);
                document.getElementById('restartButton').style.display = 'block';
            }
        }
    </script>
</body>
</html>
