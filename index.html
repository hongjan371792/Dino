<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dinoæƒ¡æç‰ˆ By hongjan</title>
    <!-- æ·»åŠ ç¶²ç«™åœ–æ¨™ -->
    <link rel="icon" type="image/png" href="icon.png">
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column; /* è®“æ¨™é¡Œå’ŒæŒ‰éˆ•å‚ç›´æ’åˆ— */
            height: 100vh;
            background-color: #2a8fd3;
            position: relative; /* è¨­å®šçˆ¶å®¹å™¨ */
        }

        canvas {
            border: 5px solid #000000;
            position: relative; /* è¨­å®š canvas ç‚ºç›¸å°å®šä½ */
            width: 100%;
            max-width: 600px; /* è¨­å®šæœ€å¤§å¯¬åº¦ç‚º 600pxï¼Œä»¥é˜²æ­¢å…§å®¹åœ¨å¤§è¢å¹•ä¸Šéå¯¬ */
        }

        .button {
            background-color: #ff7300; /* æ©˜è‰² */
            border: none;
            color: rgb(233, 233, 233);
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 8px;
        }

        .button:hover {
            background-color: #a14e00; /* æ·±æ©˜è‰² */
        }

        .text-background {
            width: 100%;
            height: 50px; /* èª¿æ•´é«˜åº¦ä»¥é©æ‡‰æ–‡å­— */
            background-color: #2a8fd3; /* èƒŒæ™¯è‰²èˆ‡ body ç›¸åŒ */
            position: absolute; /* çµ•å°å®šä½ */
            bottom: 0; /* èˆ‡åº•éƒ¨å°é½Š */
        }

        /* æ‰‹æ©Ÿå’Œå¹³æ¿è¨­å‚™æ¨£å¼ */
        @media only screen and (max-width: 768px) {
            body {
                transform: scale(0.8); /* ç¸®å°æ•´å€‹ç•«é¢ */
                transform-origin: top center; /* è¨­å®šç¸®æ”¾åŸé»ç‚ºç•«é¢é ‚éƒ¨ä¸­å¿ƒ */
            }
        }
        /* å³ä¸Šè§’éœéŸ³æŒ‰éˆ•æ¨£å¼ */
        #muteButton {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: transparent;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        #muteButton:hover {
            color: yellow;
        }
    </style>
</head>
<body>
    <!-- æ·»åŠ èƒŒæ™¯éŸ³æ¨‚ -->
    <audio id="bgMusic" loop autoplay>
        <source src="music.mp3" type="audio/mpeg">
        ç„¡æ³•æ’¥æ”¾éŸ³è¨Šï¼Œç€è¦½å™¨ä¸æ”¯æ´HTML5
    </audio>

    <!-- å³ä¸Šè§’éœéŸ³æŒ‰éˆ• -->
    <button id="muteButton" onclick="toggleMute()">
        ğŸ”Š <!-- æ’¥éŸ³ç¬¦è™Ÿ -->
    </button>

    <h1>Dinoæƒ¡æç‰ˆ</h1>
    <p>é»æ“Šæˆ–æŒ‰ä¸‹ç©ºç™½éµä½¿è€å¸«è·³èºï¼Œé¿é–‹éšœç¤™ç‰©ï¼Œç›¡å¯èƒ½ç²å¾—æ›´é«˜çš„æ€’æ°£å€¼ï¼</p>
    <p>ä½œè€…ï¼šhongjan</p>
    <button id="startButton" class="button">é–‹å§‹éŠæˆ²</button>
    <canvas id="gameCanvas" width="600" height="200" style="display: none;"></canvas>
    <button id="restartButton" class="button" style="display: none;">é‡æ–°é–‹å§‹</button>
    <a href="https://github.com/hongjan371792/Dino" class="button" target="_blank">GitHub</a>
    <a id="githubLink" class="button" target="_blank">Gihub APIè¼‰å…¥éŒ¯èª¤</a> <!-- GitHub æŒ‰é’® -->
    <div class="text-background"></div>

    <script>
        if (window.addEventListener) {
            window.addEventListener("DOMNodeRemoved", function () { window.location.reload(); }, true);
            window.addEventListener("DOMNodeRemovedFromDocument", function () { window.location.reload(); }, true);
        } 
        //ç¦ç”¨å³é”®ï¼ˆé˜²æ­¢å³é”®æŸ¥çœ‹æºä»£ç ï¼‰ 
        window.oncontextmenu = function () { return false; }
        //ç¦æ­¢ä»»ä½•é”®ç›˜æ•²å‡»äº‹ä»¶ï¼ˆé˜²æ­¢F12å’Œshift+ctrl+iè°ƒèµ·å¼€å‘è€…å·¥å…·ï¼‰ 
        window.onkeydown = window.onkeyup = window.onkeypress = function () {
            window.event.returnValue = false;
            return false;
        }        
        // JavaScript ä»£ç éƒ¨åˆ†

        // è·å– GitHub é¡¹ç›®çš„æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯
        function getLatestVersion() {
            // å‘èµ· HTTP è¯·æ±‚è·å– GitHub é¡¹ç›®çš„ä¿¡æ¯
            fetch('https://api.github.com/repos/hongjan371792/Dino/releases/latest')
                .then(response => response.json())
                .then(data => {
                    // æå–æœ€æ–°ç‰ˆæœ¬å·
                    const latestVersion = data.tag_name;
                    // æ„å»º GitHub æŒ‰é’®é“¾æ¥
                    const githubButton = document.getElementById('githubLink');
                    githubButton.href = `https://github.com/hongjan371792/Dino/releases/tag/${latestVersion}`;
                    githubButton.innerText = `æ›´æ–°èªªæ˜ ç‰ˆæœ¬ï¼š${latestVersion}`; // æ›´æ–°æŒ‰é’®æ–‡æœ¬æ˜¾ç¤ºæœ€æ–°ç‰ˆæœ¬å·
                })
                .catch(error => console.error('Error:', error));
        }

        // é¡µé¢åŠ è½½æ—¶è°ƒç”¨å‡½æ•°ä»¥è·å–æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯å¹¶æ›´æ–° GitHub æŒ‰é’®é“¾æ¥
        window.onload = function() {
            getLatestVersion();
        };
        const bgMusic = document.getElementById('bgMusic');
        bgMusic.volume = 0.5; // è¨­ç½®éŸ³é‡ç‚º50%
        let isMuted = false; // æ–°å¢ä¸€å€‹è®Šæ•¸ä¾†è¿½è¹¤éŸ³æ¨‚çš„éœéŸ³ç‹€æ…‹

        // æª¢æ¸¬è¨­å‚™é¡å‹
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // å¦‚æœæ˜¯æ‰‹æ©Ÿæˆ–å¹³æ¿ï¼Œæ‡‰ç”¨æ‰‹æ©Ÿæ¨£å¼
        if (isMobile) {
            document.body.classList.add('mobile');
        }

        // æ–°å¢ toggleMute å‡½æ•¸ä¾†åˆ‡æ›éœéŸ³ç‹€æ…‹
        function toggleMute() {
            if (isMuted) {
                bgMusic.play();
                isMuted = false;
                document.getElementById('muteButton').innerHTML = 'ğŸ”Š'; 
            } else {
                bgMusic.pause();
                isMuted = true;
                document.getElementById('muteButton').innerHTML = 'ğŸ”‡'; 
            }
        }

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        const dinoImg = new Image();
        dinoImg.src = 'dino.png'; // è§’è‰²åœ–ç‰‡è·¯å¾‘

        const obstacleImg1 = new Image();
        obstacleImg1.src = 'obstacle1.png'; // ç¬¬ä¸€ç¨®éšœç¤™ç‰©åœ–ç‰‡è·¯å¾‘

        const obstacleImg2 = new Image();
        obstacleImg2.src = 'obstacle2.png'; // ç¬¬äºŒç¨®éšœç¤™ç‰©åœ–ç‰‡è·¯å¾‘

        const cloudImg = new Image();
        cloudImg.src = 'cloud.png'; // é›²æœµåœ–ç‰‡è·¯å¾‘

        let score = 0;
        let highScore = getCookie('highScore') || 0; // ç²å– cookie ä¸­çš„æœ€é«˜åˆ†æ•¸ï¼Œå¦‚æœä¸å­˜åœ¨å‰‡é è¨­ç‚º0
        let gameOver = false;
        let gameStarted = false;

        const dino = {
            x: 50,
            y: 150,
            width: 50,
            height: 50,
            speed: 5,
            jumpForce: 20, // èª¿æ•´è§’è‰²è·³èºçš„åŠ›é‡
            fallingSpeed: 5, // èª¿æ•´è§’è‰²ä¸‹è½çš„é€Ÿåº¦
            jumping: false,
            draw() {
                ctx.drawImage(dinoImg, this.x, this.y, this.width, this.height);
            }
        };

        let obstacle = null;

        class Obstacle {
            constructor() {
                this.width = 20; // éšœç¤™ç‰©å¯¬åº¦
                this.height = Math.random() > 0.5 ? 20 : 40; // éš¨æ©Ÿé¸æ“‡å…©ç¨®ä¸åŒé«˜åº¦çš„éšœç¤™ç‰©
                if (Math.random() > 0.5) {
                    this.img = obstacleImg1;
                } else {
                    this.img = obstacleImg2;
                }
                this.x = canvas.width;
                this.y = canvas.height - this.height;
            }

            draw() {
                ctx.drawImage(this.img, this.x, this.y, this.width, this.height); // ç¹ªè£½éšœç¤™ç‰©åœ–ç‰‡
            }

            update() {
                this.x -= dino.speed;
            }
        }

        class Cloud {
            constructor() {
                this.width = Math.random() * 100 + 50; // é›²æœµå¯¬åº¦
                this.height = this.width * 0.6; // æ ¹æ“šæ¯”ä¾‹è¨ˆç®—é«˜åº¦
                this.x = canvas.width;
                this.y = Math.random() * 100; // éš¨æ©Ÿå‚ç›´ä½ç½®
                this.speed = Math.random() * 0.5 + 0.1; // éš¨æ©Ÿé€Ÿåº¦
            }

            draw() {
                ctx.drawImage(cloudImg, this.x, this.y, this.width, this.height); // ç¹ªè£½é›²æœµåœ–ç‰‡
            }

            update() {
                this.x -= this.speed;
                if (this.x + this.width < 0) {
                    this.x = canvas.width; // é›²æœµé£„éç•«é¢å¾Œé‡ç½®ä½ç½®
                }
                this.width += Math.sin(Date.now() / 1000) * 0.5; // æ”¾å¤§ç¸®å°æ•ˆæœ
                this.height += Math.cos(Date.now() / 1000) * 0.5; // æ”¾å¤§ç¸®å°æ•ˆæœ
            }
        }

        let clouds = []; // å­˜å„²é›²æœµ

        function jump() {
            if (!dino.jumping) { // åªæœ‰åœ¨ä¸åœ¨è·³èºç‹€æ…‹æ™‚æ‰èƒ½è·³èº
                dino.jumping = true;
                let jumpInterval = setInterval(() => {
                    dino.y -= dino.jumpForce;
                    if (dino.y <= 30) { // è§’è‰²æœ€é«˜é»ç‚º30
                        clearInterval(jumpInterval);
                        let fallInterval = setInterval(() => {
                            dino.y += dino.fallingSpeed;
                            if (dino.y >= 150) { // è§’è‰²å›åˆ°åœ°é¢
                                clearInterval(fallInterval);
                                dino.jumping = false;
                            }
                        }, 20);
                    }
                }, 20);
            }
        }

        document.addEventListener('keydown', event => {
            if (event.code === 'Space') {
                jump();
            }
        });

        document.addEventListener('touchstart', jump); // è§¸æ§äº‹ä»¶

        document.getElementById('startButton').addEventListener('click', () => {
            gameStarted = true;
            document.getElementById('startButton').style.display = 'none';
            canvas.style.display = 'block';
            bgMusic.play(); // åœ¨æŒ‰éˆ•é»æ“Šå¾Œæ’­æ”¾éŸ³æ¨‚
            gameLoop();
        });

        document.getElementById('restartButton').addEventListener('click', () => {
            score = 0;
            gameOver = false;
            obstacle = null;
            document.getElementById('restartButton').style.display = 'none';
            gameLoop();
        });

        function generateObstacle() {
            if (!obstacle) {
                obstacle = new Obstacle();
            }
        }

        function checkCollisions() {
            if (obstacle && dino.x < obstacle.x + obstacle.width &&
                dino.x + dino.width > obstacle.x &&
                dino.y < obstacle.y + obstacle.height &&
                dino.y + dino.height > obstacle.y) { // ç¢ºèªç¢°æ’
                    gameOver = true;
                    updateHighScore(); // æ›´æ–°æœ€é«˜åˆ†æ•¸
                    return;
                }
            score++;
        }

        function updateHighScore() {
            if (score > highScore) {
                highScore = score;
                setCookie('highScore', highScore, 365); // å°‡æœ€é«˜åˆ†æ•¸å„²å­˜åˆ° cookie ä¸­ï¼Œæœ‰æ•ˆæœŸç‚º 365 å¤©
            }
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';')[0];
        }

        function setCookie(name, value, days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = "expires=" + date.toUTCString();
            document.cookie = name + "=" + value + ";" + expires + ";path=/";
        }

        function gameLoop() {
            if (!gameOver) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // æ›´æ–°ä¸¦ç¹ªè£½é›²æœµ (é›²çš„å„ªå…ˆåŠæå‡ä»¥å°‡åœ–å±¤è¨­åœ¨æœ€ä¸‹æ–¹)
                clouds.forEach(cloud => {
                    cloud.update();
                    cloud.draw();
                });

                dino.draw();

                if (!obstacle || obstacle.x + obstacle.width < 0) {
                    obstacle = new Obstacle();
                }

                if (obstacle) {
                    obstacle.draw();
                    obstacle.update();
                }

                checkCollisions();

                ctx.fillStyle = '#333';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center'; // è¨­å®šæ–‡å­—ç½®ä¸­
                ctx.fillText(`æ€’æ°£å€¼: ${score}`, canvas.width / 2, 30); // ç¹ªè£½åˆ†æ•¸æ–‡å­—
                ctx.fillText(`æœ€é«˜: ${highScore}`, canvas.width / 2, 60); // ç¹ªè£½æœ€é«˜åˆ†æ–‡å­—

                requestAnimationFrame(gameLoop);
            } else {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#333';
                ctx.font = '30px Arial';
                ctx.textAlign = 'center'; // è¨­å®šæ–‡å­—ç½®ä¸­
                ctx.fillText('ä½ ç”¨äº†å…æ­»é‡‘ç‰Œï¼Œè¢«ç½µå¾—æ›´æ…˜äº†', canvas.width / 2, canvas.height / 2 - 20);
                ctx.fillText(`æ€’æ°£å€¼: ${score}`, canvas.width / 2, canvas.height / 2 + 20);
                ctx.fillText(`æœ€é«˜: ${highScore}`, canvas.width / 2, canvas.height / 2 + 60);
                document.getElementById('restartButton').style.display = 'block';
            }
        }

        // ç”Ÿæˆé›²æœµ
        function generateClouds() {
            for (let i = 0; i < 3; i++) { // ç”Ÿæˆ 3 å€‹é›²æœµ
                const cloud = new Cloud();
                clouds.push(cloud);
            }
        }

        generateClouds(); // éŠæˆ²é–‹å§‹æ™‚ç”Ÿæˆé›²æœµ
    </script>
</body>
</html>
